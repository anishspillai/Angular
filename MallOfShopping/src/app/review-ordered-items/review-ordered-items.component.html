<p-sidebar [(visible)]="displaySideMenuBar"
           position="right"
           [baseZIndex]="10000"
           styleClass="ui-sidebar-lg"
           (onHide)="sendCloseEvent()"
           [style]=" isDesktopApplication ? {'overflow': 'scroll', width:'35%', right: 0,
           'background-color': '#f1dfd1',
           'background-image': 'linear-gradient(315deg, #f1dfd1 0%, #f6f0ea 74%)'
           } : {'overflow': 'scroll', width:'100%', right: 0}"
           [showCloseIcon]="false">


  <button pButton label="Go Back" class="ui-button-warning ui-button-rounded" iconPos="left" icon="pi pi-angle-left"
          (click)="displaySideMenuBar = false"></button>
  <button style="float:right; margin: 2px" pButton label="Empty Cart" class="ui-button-danger ui-button-rounded"
          iconPos="left" icon="pi pi-trash" (click)="displayConfirmationDialogForItemsFromCart()">
  </button>

  <button type="button" class="btn btn-primary btn-lg btn-block font-weight-normal text-white mt-2" [disabled]="addGroceryToListObservableService.orders.length == 0" (click)="confirmOrderInCartAndMoveToConfirmationPage()">Proceed to check out</button>

  <hr style="margin-top: 2px; padding:0">

  <div *ngFor="let order of ordersAddedByUser; let i = index">
    <div class="p-grid" style="border-bottom: 1px solid lightgrey; padding: 2px" [class.red] = "i % 2 == 0">

      <div class="p-col-6">

        <div class="arrange-horizontally">
        <div class="box" style="text-align: left; padding-left: 5px; font-style: italic">
          <span>{{order.groceryName}}, {{order.grossWeight}} {{order.unitOfWeight}} </span>
          <br>
          {{order.type}}
        </div>
      </div>

      </div>

      <div class="p-col-4">
        <button class="p-col-1" pButton type="button" icon="pi pi-minus" class="ui-button-danger" (click)="decrement(order)"></button>
        <span class="p-col-2 p-col-fixed">  {{order.noOfItems}}&nbsp;&nbsp;</span>
        <button class="p-col-1" pButton type="button" icon="pi pi-plus" class="ui-button-success" (click)="increment(order)"></button>
      </div>

      <div class="p-col-2" style="text-align: left">
        <strong style="text-align: left"> {{getCostOfIndividualOrder(order)}} Kr </strong>
      </div>
    </div>
  </div>

  <ul class="list-group list-group-flush">

    <li *ngIf="getTotalCostOfOrderedItems() <= 400" class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 p-3 total-cost-background">
      <div>
        <strong class="text-danger">The Delivery Charge (Free delivery for 400 Kr )</strong>
        <small class="text-dark font-weight-bolder">
          <p class="mb-0">(Charge is 50Kr if only veggies worth 350 or less in cart)</p>
        </small>
      </div>
      <span><strong>Kr 30</strong></span>
    </li>

    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 total-cost-background p-3">
      <div>
        <strong class="text-danger">Total (Kr)</strong>
      </div>
      <span><strong>Kr {{  getTotalCostOfOrderedItemsAsString() }}</strong></span>
    </li>
  </ul>

  <div class="modal" tabindex="1" role="dialog" [ngStyle]="{'display':displayConfirmationDialogForEmptyOrder}">
    <div class="w-100 modal-dialog" role="document">
      <div class="modal-content bg-secondary">
      <span class="bg-dark text-center">
        <span class="modal-title font-weight-bold text-danger">Remove items from cart</span>
        <i class="pl-3 bi-exclamation-octagon" style="font-size: 2rem; color: orangered;"></i>
      </span>
        <div class="modal-body">
          <div class="alert alert-light" role="alert">
            <span class="alert-heading text-info">Are you sure you want to remove all items from the cart?.</span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" (click)="displayConfirmationDialogForEmptyOrder='none'">Do not
              remove
            </button>
            <button type="button" class="btn btn-danger" (click)="emptyCart()">Yes, Remove</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</p-sidebar>


<div class="backdrop" [ngStyle]="{'display':display}"></div>
<div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':display}">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <span class="text-center model-header-bg">
        <span class="modal-title text-center pt-2 pb-2">Changes in the stock</span>
        <i class="pl-3 bi-exclamation-octagon" style="font-size: 2rem; color: orangered;"></i>
      </span>
      <div class="modal-body">
        <div class="alert alert-light" role="alert">
          <span class="alert-heading text-info">Unfortunately there are changes in the items in the cart. The price of the item is changed or number of items in the stock is changed.</span>
        </div>


        <div *ngIf="stockCountChangedOrders && stockCountChangedOrders.length > 0">
          <div class="alert alert-primary text-dark medium-font-size" role="alert" style="margin-bottom: 0">
            Following stock count is reduced!. Adjusted the stock count as per the latest count in our warehouse.
          </div>
          <table class="table table-striped table-active mt-0">
            <thead>
            <tr class="font-weight-normal">
              <th scope="col">#</th>
              <th scope="col">Brand</th>
              <th scope="col">Item</th>
              <th scope="col">Previous Count</th>
              <th scope="col">New Count</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let changedOrder of stockCountChangedOrders; let i = index">
              <th scope="row">{{i + 1}}</th>
              <td>{{changedOrder.type}}</td>
              <td>{{changedOrder.groceryName}}</td>
              <td>{{changedOrder.countChangeTracker?.oldCount}}</td>
              <td class="font-weight-bold bg-danger text-white">{{changedOrder.countChangeTracker?.newCount}}</td>
            </tr>
            </tbody>
          </table>
        </div>

        <div *ngIf="priceChangedOrders && priceChangedOrders.length > 0">
          <div class="alert alert-primary text-dark medium-font-size" role="alert" style="margin-bottom: 0">
            Following stock price is changed!. Changed the price according to the latest price of the item.
          </div>
          <table class="table table-striped table-active mt-0">
            <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Brand</th>
              <th scope="col">Item</th>
              <th scope="col">Price before</th>
              <th scope="col">New Price</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let changedOrder of priceChangedOrders; let i = index">
              <th scope="row">{{i + 1}}</th>
              <td>{{changedOrder.type}}</td>
              <td>{{changedOrder.groceryName}}</td>
              <td>{{changedOrder.priceChangeTracker?.oldCost}}</td>
              <td class="font-weight-bold bg-danger text-white">{{changedOrder.priceChangeTracker?.newCost}}</td>
            </tr>
            </tbody>
          </table>
        </div>

        <div *ngIf="ordersRemovedFromCart && ordersRemovedFromCart.length > 0">
          <div class="alert alert-primary" style="margin-bottom: 0" role="alert">
            Unfortunately following items are out of stock now. It will be removed from the cart.
          </div>
          <table class="table table-striped table-light">
            <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Brand</th>
              <th scope="col">Item</th>
              <th scope="col">Weight</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let changedOrder of ordersRemovedFromCart; let i = index">
              <th scope="row">{{i + 1}}</th>
              <td>{{changedOrder.groceryName}}</td>
              <td>{{changedOrder.type}}</td>
              <td>{{changedOrder.grossWeight + ' ' + changedOrder.unitOfWeight}}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModelDialog()">Close Dialog</button>
        <button type="button" class="btn btn-warning" (click)="updateShoppingCartDatabaseAndCloseDialog()">Accept changes and proceed</button>
      </div>
    </div>
  </div>
</div>
